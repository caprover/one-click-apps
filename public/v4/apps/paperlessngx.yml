captainVersion: 4
services:
    $$cap_appname:
        image: ghcr.io/paperless-ngx/paperless-ngx:$$cap_paperless_version
        depends_on:
            - $$cap_appname-postgres
            - $$cap_appname-redis
        volumes:
            - $$cap_appname-data:/usr/src/paperless/data
            - $$cap_appname-media:/usr/src/paperless/media
            - $$cap_appname-export:/usr/src/paperless/export
            - $$cap_appname-consume:/consume
        environment:
            USERMAP_UID: 1000
            USERMAP_GID: 1000
            PAPERLESS_OCR_THREADS: 2
            PAPERLESS_CONVERT_DENSITY: 300
            PAPERLESS_OCR_LANGUAGE: $$cap_ocr_language
            PAPERLESS_REDIS: redis://srv-captain--$$cap_appname-redis:6379
            PAPERLESS_DBHOST: srv-captain--$$cap_appname-postgres
            PAPERLESS_DBPORT: 5432
            PAPERLESS_DBUSER: $$cap_dbuser
            PAPERLESS_DBPASS: $$cap_dbpass
            PAPERLESS_DBNAME: $$cap_dbname
            PAPERLESS_SECRET_KEY: $$cap_secret_key
            PAPERLESS_ADMIN_USER: $$cap_admin_user
            PAPERLESS_ADMIN_PASSWORD: $$cap_admin_password
            PAPERLESS_ADMIN_MAIL: $$cap_admin_mail
            PAPERLESS_URL: http://$$cap_appname.$$cap_root_domain
            PAPERLESS_TIKA_ENABLED: 1
            PAPERLESS_TIKA_GOTENBERG_ENDPOINT: http://srv-captain--$$cap_appname-gotenberg:3000
            PAPERLESS_TIKA_ENDPOINT: http://srv-captain--$$cap_appname-tika:9998
            
		 caproverExtra:
            containerHttpPort: '8000'
            

    $$cap_appname-postgres:
        image: postgres:13
        volumes:
            - $$cap_appname-db-data:/var/lib/postgresql/data
        environment:
            POSTGRES_USER: $$cap_dbuser
            POSTGRES_PASSWORD: $$cap_dbpass
            POSTGRES_DB: $$cap_dbname

    $$cap_appname-redis:
        image: redis:alpine

    # gotenberg
    $$cap_appname-gotenberg:
        image: thecodingmachine/gotenberg:7.8
        restart: unless-stopped
        environment:
            DISABLE_GOOGLE_CHROME: 1
        caproverExtra:
            containerHttpPort: '3000'

    # tika
    $$cap_appname-tika:
        image: apache/tika
        restart: unless-stopped
        caproverExtra:
            containerHttpPort: '9998'

caproverOneClickApp:
    variables:
        - id: $$cap_appname
          label: App Name
          defaultValue: paperless-ngx
          description: The name of the app in CapRover. You can keep the default value or choose a different name.
        - id: $$cap_paperless_version
          label: Version
          defaultValue: 1.13
          description: Use a valid tag 
        - id: $$cap_dbuser
          label: PostgreSQL Username
          defaultValue: paperless
          description: The username for the PostgreSQL database.
        - id: $$cap_dbpass
          label: PostgreSQL Password
          defaultValue: ''
          description: The password for the PostgreSQL database. Please choose a strong password.
        - id: $$cap_dbname
          label: PostgreSQL Database Name
          defaultValue: paperless
          description: The name of the PostgreSQL database used by Paperless-NGX.
        - id: $$cap_ocr_language
          label: OCR-Languages
          defaultValue: eng
          description: The OCR language used by Paperless-NGX. You can provide a single language code (e.g., eng) or multiple language codes separated by + (e.g., eng+deu)
        - id: $$cap_secret_key
          label: Secret-key
          defaultValue: r0she2RZfCGc1959xZMngMVDGofrMmyX
          description: Just smash your face on the keyboard
        - id: $$cap_admin_user
          label: Adminuser
          defaultValue: Admin
          description: adminname
        - id: $$cap_admin_password
          label: Adminpassword
          defaultValue: Adminpassword
          description: Adminpassword
        - id: $$cap_paperless_url
          label: paperlessurl
          defaultValue: ''
          description: Set the URL pointing to Paperless

    instructions:
        start: >-
            This will deploy the Paperless-NGX One-Click-App. Please provide the required information below.
        end: >-
            The Paperless-NGX app has been successfully deployed. Please give it a few minutes to start, and then you can access the web interface by navigating to the app URL. The default username is "admin" and the default password is "Adminpassword". Make sure to change the default credentials after logging in for the first time.
            Please make sure that the HTTP Port is set to 8000 under the HTTP-Settings tab.
