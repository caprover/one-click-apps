captainVersion: 4
services:
    $$cap_appname:
        image: rustfs/rustfs:$$cap_rustfs_version
        volumes:
            - $$cap_appname-db-data:/data
        restart: always
        environment:
            RUSTFS_VOLUMES: /data
            RUSTFS_CONSOLE_ENABLE: 'true'
            RUSTFS_EXTERNAL_ADDRESS: 'https://$$cap_appname-api.$$cap_root_domain'
            RUSTFS_ACCESS_KEY: $$cap_access_key
            RUSTFS_SECRET_KEY: $$cap_secret_key
        caproverExtra:
            containerHttpPort: '9001'
    $$cap_appname-api:
        image: caprover/nginx-reverse-proxy:1-cc035d1
        restart: always
        depends_on:
            - $$cap_appname
        environment:
            UPSTREAM_HTTP_ADDRESS: http://srv-captain--$$cap_appname:9000
            CLIENT_MAX_BODY_SIZE: '0'
caproverOneClickApp:
    variables:
        - id: $$cap_rustfs_version
          label: RustFS Version
          defaultValue: 1.0.0-alpha.77
          description: Check out their Docker page for the valid tags https://hub.docker.com/r/rustfs/rustfs/tags
          validRegex: /^([^\s^\/])+$/
        - id: $$cap_access_key
          label: RustFS User Access Key
          defaultValue: $$cap_gen_random_hex(24)
          description: Access key for `RUSTFS_ACCESS_KEY`. If unset, RustFS defaults to `rustfsadmin`. RustFS strongly recommends specifying a unique, long, and random value for all environments.
          validRegex: /(.{5,})|(^\s{0}$)/m
        - id: $$cap_secret_key
          label: RustFS Secret Key
          defaultValue: $$cap_gen_random_hex(38)
          description: Secret key for `RUSTFS_SECRET_KEY`. If unset, RustFS defaults to `rustfsadmin`. RustFS strongly recommends specifying a unique, long, and random value for all environments.
          validRegex: /(.{8,})|(^\s{0}$)/m
    instructions:
        start: >-
            RustFS is a high-performance distributed object storage software built using Rust, one of the most popular languages worldwide. Along with MinIO, it shares a range of advantages such as simplicity, S3 compatibility, open-source nature, support for data lakes, AI, and big data. Furthermore, it has a better and more user-friendly open-source license in comparison to other storage systems, being constructed under the Apache license. As Rust serves as its foundation, RustFS provides faster speed and safer distributed features for high-performance object storage.
        end: |-

            ‚úÖ  RustFS has been deployed!
            --------------------------------------------
            _RustFS has been successfully deployed! Be sure to read the next steps below before attempting to access https://$$cap_appname.$$cap_root_domain._

            --------------------------------------------
            ‚ùóÔ∏è **IMPORTANT**: Before launching RustFS be sure to change the following settings:

            **Step 1**: Go to the settings for `$$cap_appname` and `$$cap_appname-api`
            **Step 2**: Enable **HTTPS**
            **Step 3**: Enable **Websocket Support**

            üîê Dashboard access uses the keys set during deployment. If left blank, RustFS sets the keys by default to rustfsadmin.

            **Access Key**: $$cap_access_key
            **Secret Key**: $$cap_secret_key

            üåê After completing the steps above, you can access RustFS at:

            **Dashboard**: https://$$cap_appname.$$cap_root_domain
            **S3 API Endpoint**: https://$$cap_appname-api.$$cap_root_domain

            --------------------------------------------
            üî∞ More information on initial configuration can be found at https://docs.rustfs.com/installation/docker/#_5-other-recommendations

    displayName: 'RustFS'
    isOfficial: true
    description: RustFS is a high-performance distributed object storage software built using Rust
    documentation: Taken from https://docs.rustfs.com/installation/docker/
