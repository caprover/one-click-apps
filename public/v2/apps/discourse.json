{
    "captainVersion": "2",
    "documentation": "Taken from",
    "displayName": "discourse",
    "description": "",
    "dockerCompose": {
        "version": "2",
        "services": {
          "postgresql": {
            "documentation": "Taken from https://hub.docker.com/r/bitnami/postgresql",
            "image": "docker.io/bitnami/postgresql:$$cap_postgresql_version",
            "notExposeAsWebApp": "true",
            "restart": "always",
            "environment": [
              "ALLOW_EMPTY_PASSWORD=yes"
            ],
            "volumes": [
              "postgresql-data:/bitnami/postgresql"
            ]
          },
          "redis": {
            "documentation": "Taken from https://hub.docker.com/r/bitnami/redis",
            "image": "docker.io/bitnami/redis:$$cap_redis_version",
            "notExposeAsWebApp": "true",
            "restart": "always",
            "environment": [
              "ALLOW_EMPTY_PASSWORD=yes"
            ],
            "volumes": [
              "redis-data:/bitnami"
            ]
          },
          "discourse": {
            "documentation":"Taken from https://hub.docker.com/r/bitnami/discourse",
            "image": "docker.io/bitnami/discourse:$$cap_disource_version",
            "notExposeAsWebApp": "true",
            "ports": [
              "80:3000"
            ],
            "depends_on": [
              "postgresql",
              "redis"
            ],
            "volumes": [
              "discourse-data:/bitnami"
            ],
            "environment": [
              "POSTGRESQL_HOST=postgresql",
              "POSTGRESQL_ROOT_USER=postgres",
              "POSTGRESQL_CLIENT_CREATE_DATABASE_NAME=bitnami_application",
              "POSTGRESQL_CLIENT_CREATE_DATABASE_USERNAME=bn_discourse",
              "POSTGRESQL_CLIENT_CREATE_DATABASE_PASSWORD=bitnami1",
              "DISCOURSE_POSTGRESQL_NAME=bitnami_application",
              "DISCOURSE_POSTGRESQL_USERNAME=bn_discourse",
              "DISCOURSE_POSTGRESQL_PASSWORD=bitnami1",
              "DISCOURSE_HOSTNAME=$$cap_appname.$$cap_root_domain"
            ]
          },
          "sidekiq": {
            "documentaion": "Taken from https://hub.docker.com/r/bitnami/discourse",
            "image": "docker.io/bitnami/discourse:$$cap_discourse_version",
            "notExposeAsWebApp": "true",
            "depends_on": [
              "discourse"
            ],
            "volumes": [
              "discourse-data:/bitnami"
            ],
            "command": "nami start --foreground discourse-sidekiq",
            "environment": [
              "DISCOURSE_POSTGRESQL_NAME=bitnami_application",
              "DISCOURSE_POSTGRESQL_USERNAME=bn_discourse",
              "DISCOURSE_POSTGRESQL_PASSWORD=bitnami1",
              "DISCOURSE_HOST=discourse",
              "DISCOURSE_PORT=3000",
              "DISCOURSE_HOSTNAME=$$cap_appname.$$cap_root_domain"
            ]
          }
        },
        "volumes": {
          "postgresql_data": {
            "driver": "local"
          },
          "redis_data": {
            "driver": "local"
          },
          "discourse_data": {
            "driver": "local"
          }
        }
      },
      "instructions": {
          "start": "",
          "end": ""
      },
      "variables": [{
          "id": "$$cap_discourse_version",
          "label": "Discourse Version",
          "defaultValue": "2-debian-10",
          "description": "TODO",
          "validRegex": "/^([^\\s^\\/])+$/"
      },{
          "id": "$$cap_postgresql_version",
          "label": "Postgresql (database) version",
          "defaultValue": "11-debian-10",
          "description": "TODO",
          "validRegex": "/^([^\\s^\\/])+$/"
      },{
          "id": "$$cap_redis_version",
          "label": "Redis version",
          "defaultValue": "5.0-debian-10",
          "description": "TODO",
          "validRegex": "/^([^\\s^\\/])+$/"
      },{
          "id": "$$cap_db_pass",
          "label": "database password",
          "description": "Password for the database user and root using postgresql",
          "validRegex": "/.{1,}/"
      },{
          "id": "$$cap_db_user",
          "label": "database user",
          "defaultValue": "discourse",
          "description": "Username for the database using postgresql",
          "validRegex": "/^([^\\s^\\/])+$/"
      }]
}
