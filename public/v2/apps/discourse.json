{
    "captainVersion": "2",
    "documentation": "Taken from https://hub.docker.com/r/bitnami/discourse",
    "displayName": "Discourse",
    "description": "Discourse is the 100% open source discussion platform built for the next decade of the Internet. Use it as a mailing list, discussion forum, long-form chat room, and more!",
    "dockerCompose": {
        "version": "2",
        "services": {
            "$$cap_appname-postgresql": {
                "documentation": "Taken from https://hub.docker.com/r/bitnami/postgresql",
                "image": "docker.io/bitnami/postgresql:$$cap_postgresql_version",
                "notExposeAsWebApp": "true",
                "restart": "always",
                "environment": ["ALLOW_EMPTY_PASSWORD=yes"],
                "volumes": ["$$cap_appname-postgresql-data:/bitnami/postgresql"]
            },
            "$$cap_appname-redis": {
                "documentation": "Taken from https://hub.docker.com/r/bitnami/redis",
                "image": "docker.io/bitnami/redis:$$cap_redis_version",
                "notExposeAsWebApp": "true",
                "restart": "always",
                "environment": ["ALLOW_EMPTY_PASSWORD=yes"],
                "volumes": ["$$cap_appname-redis-data:/bitnami"]
            },
            "$$cap_appname": {
                "documentation": "Taken from https://hub.docker.com/r/bitnami/discourse",
                "image": "docker.io/bitnami/discourse:$$cap_discourse_version",
                "containerHttpPort": "3000",
                "depends_on": [
                    "$$cap_appname-postgresql",
                    "$$cap_appname-redis"
                ],
                "volumes": ["$$cap_appname-data:/bitnami"],
                "environment": [
                    "POSTGRESQL_HOST=$$cap_appname-postgresql",
                    "POSTGRESQL_ROOT_USER=$$cap_root_user",
                    "POSTGRESQL_CLIENT_CREATE_DATABASE_NAME=$$cap_db_name",
                    "POSTGRESQL_CLIENT_CREATE_DATABASE_USERNAME=$$cap_db_user",
                    "POSTGRESQL_CLIENT_CREATE_DATABASE_PASSWORD=$$cap_db_pass",
                    "DISCOURSE_POSTGRESQL_NAME=$$cap_db_name",
                    "DISCOURSE_POSTGRESQL_USERNAME=$$cap_db_user",
                    "DISCOURSE_POSTGRESQL_PASSWORD=$$cap_db_pass",
                    "DISCOURSE_HOSTNAME=$$cap_appname.$$cap_root_domain"
                ]
            },
            "$$cap_appname-sidekiq": {
                "documentaion": "Taken from https://hub.docker.com/r/bitnami/discourse",
                "image": "docker.io/bitnami/discourse:$$cap_discourse_version",
                "notExposeAsWebApp": "true",
                "depends_on": ["$$cap_appname"],
                "volumes": ["$$cap_appname-data:/bitnami"],
                "dockerfileLines": [
                    "FROM docker.io/bitnami/discourse:$$cap_discourse_version",
                    "CMD [\"nami\" , \"start\" , \"--foreground discourse-sidekiq\"]"
                ],
                "environment": [
                    "DISCOURSE_POSTGRESQL_NAME=$$cap_db_name",
                    "DISCOURSE_POSTGRESQL_USERNAME=$$cap_db_user",
                    "DISCOURSE_POSTGRESQL_PASSWORD=$$cap_db_pass",
                    "DISCOURSE_HOST=$$cap_appname",
                    "DISCOURSE_PORT=3000",
                    "DISCOURSE_HOSTNAME=$$cap_appname.$$cap_root_domain"
                ]
            }
        }
    },
    "instructions": {
        "start": "Discourse is the 100% open source discussion platform built for the next decade of the Internet. Use it as a mailing list, discussion forum, long-form chat room, and more!",
        "end": "Discourse is deployed and will be available in the next few minutes as $$cap_appname"
    },
    "variables": [
        {
            "id": "$$cap_discourse_version",
            "label": "Discourse Version",
            "defaultValue": "2-debian-10",
            "description": "Version of Discourse",
            "validRegex": "/^([^\\s^\\/])+$/"
        },
        {
            "id": "$$cap_postgresql_version",
            "label": "Postgresql (database) version",
            "defaultValue": "11-debian-10",
            "description": "Version of Postgresql",
            "validRegex": "/^([^\\s^\\/])+$/"
        },
        {
            "id": "$$cap_redis_version",
            "label": "Redis version",
            "defaultValue": "5.0-debian-10",
            "description": "Version of Redis",
            "validRegex": "/^([^\\s^\\/])+$/"
        },
        {
            "id": "$$cap_root_user",
            "label": "Root user",
            "defaultValue": "postgres",
            "description": "Root name of the database",
            "validRegex": "/^([^\\s^\\/])+$/"
        },
        {
            "id": "$$cap_db_name",
            "label": "Database name",
            "defaultValue": "discourse_db",
            "description": "Name for the database using postgresql",
            "validRegex": "/^([^\\s^\\/])+$/"
        },
        {
            "id": "$$cap_db_user",
            "label": "Database user",
            "defaultValue": "discourse_user",
            "description": "Username for the database using postgresql",
            "validRegex": "/^([^\\s^\\/])+$/"
        },
        {
            "id": "$$cap_db_pass",
            "label": "Database password",
            "description": "Password for the database user and root using postgresql",
            "validRegex": "/.{1,}/"
        }
    ]
}
